version: "3.4"
services:
  teku:
    image: consensys/teku:latest
    container_name: teku
    depends_on: 
      - besu
      - keytool
    volumes:
      - ./teku_data:/consensus_data
      - ./secrets/keys/teku-keys:/keys
      - ./secrets/keys/teku-secrets:/secrets
      - ./mnsf3-config:/config
    command: >
      --network "/config/config.yaml"
      --initial-state "/config/genesis.ssz"
      --data-path "/consensus_data" --data-storage-mode=PRUNE
      --p2p-enabled=true --eth1-endpoints=http://127.0.0.1:8545
      --ee-endpoint=http://127.0.0.1:8550
      --p2p-advertised-ip=$IP_ADDRESS --p2p-discovery-bootnodes=$ENR
      --rest-api-enabled=true --rest-api-docs-enabled=true
      --rest-api-interface=0.0.0.0 --rest-api-port=4000
      --rest-api-host-allowlist=* --data-storage-non-canonical-blocks-enabled=true
      --ee-jwt-secret-file="/config/jwtsecret"
      --Xnetwork-total-terminal-difficulty-override=$TOTAL_TERMINAL_DIFFICULTY
      --log-destination=CONSOLE
    network_mode: host
